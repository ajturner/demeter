import{r as e,h as t,H as r}from"./p-7c78c4f2.js";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var s=function(){s=Object.assign||function e(t){for(var r,s=1,n=arguments.length;s<n;s++){r=arguments[s];for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i))t[i]=r[i]}return t};return s.apply(this,arguments)};function n(e){return Object.keys(e).some((t=>{let r=e[t];if(!r){return false}if(r&&r.toParam){r=r.toParam()}const s=r.constructor.name;switch(s){case"Array":return false;case"Object":return false;case"Date":return false;case"Function":return false;case"Boolean":return false;case"String":return false;case"Number":return false;default:return true}}))}function i(e){const t={};Object.keys(e).forEach((r=>{var s,n;let i=e[r];if(i&&i.toParam){i=i.toParam()}if(!i&&i!==0&&typeof i!=="boolean"&&typeof i!=="string"){return}const o=i.constructor.name;let a;switch(o){case"Array":const e=(n=(s=i[0])===null||s===void 0?void 0:s.constructor)===null||n===void 0?void 0:n.name;a=e==="Array"?i:e==="Object"?JSON.stringify(i):i.join(",");break;case"Object":a=JSON.stringify(i);break;case"Date":a=i.valueOf();break;case"Function":a=null;break;case"Boolean":a=i+"";break;default:a=i;break}if(a||a===0||typeof a==="string"||Array.isArray(a)){t[r]=a}}));return t}function o(e,t){if(Array.isArray(t)&&t[0]&&Array.isArray(t[0])){return t.map((t=>o(e,t))).join("&")}return encodeURIComponent(e)+"="+encodeURIComponent(t)}function a(e){const t=i(e);return Object.keys(t).map((e=>o(e,t[e]))).join("&")}var u={FormData:globalThis.FormData,File:globalThis.File,Blob:globalThis.Blob};function c(e,t){const r=n(e)||t;const s=i(e);if(r){const e=new u.FormData;Object.keys(s).forEach((t=>{if(typeof Blob!=="undefined"&&s[t]instanceof Blob){const r=s["fileName"]||s[t].name||t;e.append(t,s[t],r)}else{e.append(t,s[t])}}));return e}else{return a(e)}}class l extends Error{constructor(e,t,r,s,n){super(e);const i=new.target.prototype;Object.setPrototypeOf(this,i);e=e||"UNKNOWN_ERROR";t=t||"UNKNOWN_ERROR_CODE";this.name="ArcGISRequestError";this.message=t==="UNKNOWN_ERROR_CODE"?e:`${t}: ${e}`;this.originalMessage=e;this.code=t;this.response=r;this.url=s;this.options=n}}function h(e){if(console&&console.warn){console.warn.apply(console,[e])}}var f=function e(){return Promise.resolve({fetch:globalThis.fetch,Headers:globalThis.Headers,Response:globalThis.Response,Request:globalThis.request})};const d=`@esri/arcgis-rest-js`;function p(){return globalThis.DEFAULT_ARCGIS_REQUEST_OPTIONS||{httpMethod:"POST",params:{f:"json"}}}class g extends l{constructor(e="AUTHENTICATION_ERROR",t="AUTHENTICATION_ERROR_CODE",r,s,n){super(e,t,r,s,n);this.name="ArcGISAuthError";this.message=t==="AUTHENTICATION_ERROR_CODE"?e:`${t}: ${e}`;const i=new.target.prototype;Object.setPrototypeOf(this,i)}retry(e,t=1){let r=0;const s=(n,i)=>{r=r+1;e(this.url,this.options).then((e=>{const t=Object.assign(Object.assign({},this.options),{authentication:e});return O(this.url,t)})).then((e=>{n(e)})).catch((e=>{if(e.name==="ArcGISAuthError"&&r<t){s(n,i)}else if(e.name===this.name&&e.message===this.message&&r>=t){i(this)}else{i(e)}}))};return new Promise(((e,t)=>{s(e,t)}))}}function m(e,t,r,s,n){if(e.code>=400){const{message:r,code:n}=e;throw new l(r,n,e,t,s)}if(e.error){const{message:r,code:i,messageCode:o}=e.error;const a=o||i||"UNKNOWN_ERROR_CODE";if(i===498||i===499){if(n){throw n}else{throw new g(r,a,e,t,s)}}throw new l(r,a,e,t,s)}if(e.status==="failed"||e.status==="failure"){let r;let n="UNKNOWN_ERROR_CODE";try{r=JSON.parse(e.statusMessage).message;n=JSON.parse(e.statusMessage).code}catch(t){r=e.statusMessage||e.message}throw new l(r,n,e,t,s)}return e}function O(e,t){const r=p();const s=Object.assign(Object.assign(Object.assign({httpMethod:"POST"},r),t),{params:Object.assign(Object.assign({},r.params),t.params),headers:Object.assign(Object.assign({},r.headers),t.headers)});const{httpMethod:i,rawResponse:o}=s;const u=Object.assign({f:"json"},s.params);let g=null;const O={method:i,signal:s.signal,credentials:s.credentials||"same-origin"};if(s.headers&&s.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1){O.credentials="include"}let b;if(typeof s.authentication==="string"){const e=s.authentication;b={portal:"https://www.arcgis.com/sharing/rest",getToken:()=>Promise.resolve(e)};if(!s.authentication.startsWith("AAPK")&&!s.suppressWarnings&&!globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING){h(`Using an oAuth 2.0 access token directly in the token option is discouraged. Consider using ArcGISIdentityManager or Application session. See https://esriurl.com/arcgis-rest-js-direct-token-warning for more information.`);globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING=true}}else{b=s.authentication}const y=e;return(b?b.getToken(e).catch((t=>{t.url=e;t.options=s;g=t;return Promise.resolve("")})):Promise.resolve("")).then((t=>{if(t.length){u.token=t}if(b&&b.getDomainCredentials){O.credentials=b.getDomainCredentials(e)}const r={};if(O.method==="GET"){if(u.token&&s.hideToken&&typeof window==="undefined"){r["X-Esri-Authorization"]=`Bearer ${u.token}`;delete u.token}const n=a(u);const i=n===""?e:e+"?"+a(u);if(s.maxUrlLength&&i.length>s.maxUrlLength||u.token&&s.hideToken){O.method="POST";if(t.length&&s.hideToken){u.token=t;delete r["X-Esri-Authorization"]}}else{e=i}}const i=new RegExp("/items/.+/updateResources").test(e);if(O.method==="POST"){O.body=c(u,i)}O.headers=Object.assign(Object.assign({},r),s.headers);if((typeof window==="undefined"||window&&typeof window.document==="undefined")&&!O.headers.referer){O.headers.referer=d}if(!n(u)&&!i){O.headers["Content-Type"]="application/x-www-form-urlencoded"}return globalThis.fetch?globalThis.fetch(e,O):f().then((({fetch:t})=>t(e,O)))})).then((t=>{if(!t.ok){return t.json().then((r=>{const{status:n,statusText:i}=t;const{message:o,details:a}=r.error;const u=`${o}. ${a?a.join(" "):""}`.trim();throw new l(u,`HTTP ${n} ${i}`,r,e,s)})).catch((r=>{if(r.name==="ArcGISRequestError"){throw r}const{status:n,statusText:i}=t;throw new l(i,`HTTP ${n}`,t,e,s)}))}if(o){return t}switch(u.f){case"json":return t.json();case"geojson":return t.json();case"html":return t.text();case"text":return t.text();default:return t.blob()}})).then((t=>{if((u.f==="json"||u.f==="geojson")&&!o){const r=m(t,y,u,s,g);if(g){const t=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];s.authentication.federatedServers[t]={token:[],expires:new Date(Date.now()+86400*1e3)};g=null}return r}else{return t}}))}function b(e,t={params:{f:"json"}}){return O(e,t).catch((e=>{if(e instanceof g&&t.authentication&&typeof t.authentication!=="string"&&t.authentication.canRefresh&&t.authentication.refreshCredentials){return e.retry((()=>t.authentication.refreshCredentials()),1)}else{return Promise.reject(e)}}))}function y(e,t,r){const s=["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"];const n=Object.assign(Object.assign({params:{}},r),e);n.params=t.reduce(((t,r)=>{if(e[r]||typeof e[r]==="boolean"||typeof e[r]==="number"&&e[r]===0){t[r]=e[r]}return t}),n.params);return s.reduce(((e,t)=>{if(n[t]){e[t]=n[t]}return e}),{})}function w(e){if(typeof e!=="string"){return e}e=e.trim();if(e[e.length-1]==="/"){e=e.slice(0,-1)}return e}function R(e){var t=y(e,["where","objectIds","relationParam","time","distance","units","outFields","geometry","geometryType","spatialRel","returnGeometry","maxAllowableOffset","geometryPrecision","inSR","outSR","gdbVersion","returnDistinctValues","returnIdsOnly","returnCountOnly","returnExtentOnly","orderByFields","groupByFieldsForStatistics","outStatistics","returnZ","returnM","multipatchOption","resultOffset","resultRecordCount","quantizationParameters","returnCentroid","resultType","historicMoment","returnTrueCurves","sqlFormat","returnExceededLimitFeatures","f"],{httpMethod:"GET",params:s({where:"1=1",outFields:"*"},e.params)});return b(w(e.url)+"/query",t)}const T=":host{display:block}.feature{max-width:280px;cursor:pointer;box-shadow:0 0 0 1px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.1)}.feature:hover{box-shadow:0 0 0 1px rgba(0, 0, 0, 0.1), 0 4px 8px rgba(0, 0, 0, 0.1)}#nearby{display:grid;grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));grid-gap:1rem;margin:1rem 0}";const j=class{constructor(t){e(this,t);this.featureId=undefined;this.featureLayerUrl=undefined;this.fields=[];this.distance=20;this.feature=undefined;this.nearbyFeatures=[];this.similarFeatures="";this.uniqueValues="";this.totalFeatures=""}async componentWillLoad(){await this.getFeatureMetadata()}async getFeatureMetadata(){const e=await R({url:this.featureLayerUrl,where:"OBJECTID = "+this.featureId,outFields:"*",returnGeometry:true,resultRecordCount:1,outSR:"4326"});this.feature=e.features[0];this.getNearbyFeatureMetadata(this.feature.geometry);this.getSimilarFeatureMetadata("CMMN_NM",this.feature.attributes.CMMN_NM);this.getTotalFeatureMetadata()}async getSimilarFeatureMetadata(e,t){const r=await R({url:this.featureLayerUrl,where:`${e} = '${t}'`,returnCountOnly:true,groupByFieldsForStatistics:e,outFields:"*",returnGeometry:false});this.similarFeatures=r.count;console.log("Aggregate",{aggregate:r})}async getTotalFeatureMetadata(){const e=await R({url:this.featureLayerUrl,returnCountOnly:true,returnGeometry:false});this.totalFeatures=e.count}async getNearbyFeatureMetadata(e){const t={x:e.x,y:e.y,spatialReference:{wkid:4326}};const r=await R({url:this.featureLayerUrl,outFields:"*",returnGeometry:true,outSR:"4326",geometryType:"esriGeometryPoint",geometry:t,distance:this.distance,units:"esriSRUnit_Meter"});this.nearbyFeatures=r.features}convertAttributeByType(e,t){if(t==="date"){return new Date(e).toLocaleDateString()}else{return e}}render(){return t(r,null,t("slot",null),t("h3",null,"Exploring this Feature"),this.renderMetadata(this.feature),t("h4",null,"Similar Features"),JSON.stringify(this.similarFeatures),t("h4",null,"Total Features"),JSON.stringify(this.totalFeatures),t("h4",null,"Nearby Features"),t("div",{id:"nearby"},this.nearbyFeatures.map((e=>this.renderMetadata(e)))))}viewFeature(e){open(`./?featureId=${e}`,"_top")}renderMetadata(e){return t("calcite-card",{class:"feature",onClick:()=>this.viewFeature(e.attributes.OBJECTID)},t("ul",null,this.fields.map((r=>t("li",null,r.name,": ",this.convertAttributeByType(e.attributes[r.attribute],r.type))))))}};j.style=T;export{j as demeter_metadata};
//# sourceMappingURL=p-681ce9e9.entry.js.map